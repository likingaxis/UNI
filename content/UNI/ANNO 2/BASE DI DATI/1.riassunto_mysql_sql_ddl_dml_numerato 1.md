
# Riassunto Lezione: MySQL - SQL DDL e DML

## 1. Introduzione: Contenuti della lezione
La lezione tratta i seguenti argomenti:
- SQL e DBMS
- MySQL e sua installazione
- DDL (Data Definition Language)
- DML (Data Manipulation Language)
- Vincoli di integrità

---

## 2. SQL: Cos'è e a cosa serve
**SQL (Structured Query Language)** è un linguaggio:
- Nato come *SEQUEL* nel 1974.
- Standard de facto dal 1983.
- Standardizzato a partire dal 1986 con aggiornamenti successivi.

**SQL include:**
- **DDL**: per creare e modificare la struttura del database (es. tabelle).
- **DML**: per inserire, modificare, cancellare e leggere dati.

**Esempio:**  
- DDL: `CREATE TABLE studenti (...)`
- DML: `INSERT INTO studenti VALUES (...)`

---

## 3. DBMS: Sistema di Gestione di Basi di Dati
Un **DBMS** (Database Management System) è un software che gestisce dati in modo:
- **Affidabile** (garanzia di integrità e backup)
- **Condiviso** (più utenti possono accedere)
- **Efficiente** (ottimizza l’uso delle risorse)
- **Sicuro** (accessi protetti)
- **Persistente** (i dati non si perdono)

---

## 4. MySQL: Un DBMS relazionale
**MySQL** è:
- Un **RDBMS** (Relational DBMS) open source di Oracle.
- Estremamente diffuso.
- Disponibile in versione gratuita (community) e commerciale (enterprise).
- Associato al tool grafico **MySQL Workbench**.

### Caratteristiche:
- Scritto in C/C++, usa engine **InnoDB** (supporta transazioni e vincoli FK).
- Interfacciabile con C, Java, Python.
- Nessun limite specifico su tabelle/dimensione (dipende dall’OS).
- Ha fork come **MariaDB**.

---

## 5. Ranking dei DBMS
Nel grafico *DB-Engines Ranking* (slide 10), si osserva la popolarità nel tempo:  
**Oracle, MySQL e SQL Server** sono tra i più usati. MySQL ha una posizione stabile e alta.

---

## 6. Installazione di MySQL
Disponibile su:  
[https://www.mysql.com/it/downloads/](https://www.mysql.com/it/downloads/)  
Usare **MySQL Installer for Windows** (Community Edition - GPL).

---

## 7. Accesso da Terminale
Connessione da terminale:
```bash
mysql -u nome_utente -p
```
Opzioni:
- `-P` porta
- `-h` host

---

## 8. Comandi SQL di Base
- `SHOW DATABASES;` → mostra i database esistenti  
- `USE nomedb;` → seleziona un database  
- `CREATE DATABASE nomedb;` → crea un database  
- `DROP DATABASE nomedb;` → elimina un database  
- `EXIT;` → esce dalla sessione

**Nota:** ogni comando termina con `;`

---

## 9. Domini in SQL
I **domini** sono insiemi di valori ammissibili per un attributo.

### Tipi:
- **Elementari** (predefiniti): es. interi, stringhe, date
- **Definiti dall’utente**: utili per riusabilità

---

## 10. Tipi di dato elementari

### Numerici:
- `TINYINT`: da -128 a 127  
- `SMALLINT`: da -32.768 a 32.767  
- `INT`: da -2.147.483.648 a 2.147.483.647  
- `FLOAT(M,D)`, `DOUBLE(M,D)`: decimali con precisione

### Alfanumerici:
- `CHAR(x)`: stringa a lunghezza fissa  
- `VARCHAR(x)`: lunghezza variabile  
- `TEXT`: fino a 65.535 byte  
- `BLOB`: oggetti binari (es. immagini)

**Nota:** Non creare indici su `TEXT` e `BLOB`

### Temporali:
- `DATE`: yyyy-mm-dd  
- `TIME`: hh:mm:ss  
- `DATETIME`: data e ora  
- `YEAR`: solo anno  
- `TIMESTAMP(x)`: data e ora con precisione variabile

---

## 11. Creazione di Domini (SQL standard, non MySQL)
```sql
CREATE DOMAIN Voto AS SMALLINT DEFAULT NULL 
CHECK (value >= 18 AND value <= 30);
```

---

## 12. Creazione e Cancellazione Tabelle (DDL)
```sql
CREATE TABLE nome (
  attributo tipo opzioni,
  ...
);
DROP TABLE nome;
```

Chi crea la tabella ne possiede tutti i diritti. La tabella inizialmente è vuota.

---

## 13. Storage Engine: InnoDB vs MyISAM

### InnoDB:
- Supporta transazioni
- Supporta chiavi esterne
- Più robusto

### MyISAM:
- Più efficiente e veloce
- Meno sicuro (no transazioni)
- Consuma meno spazio

---

## 14. Specificare l’engine nella creazione
```sql
CREATE TABLE nome (
  attributo tipo,
  ...
) ENGINE=InnoDB;
```

---

## 15. Esempio completo di creazione
```sql
CREATE TABLE emp (
  empno INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  ename VARCHAR(30) NOT NULL,
  sal FLOAT(4,2)
);
DROP TABLE emp;
```

In questo esempio:
- `empno` è la chiave primaria e si incrementa automaticamente.
- `ename` è obbligatorio (`NOT NULL`)
- `sal` è uno stipendio con 4 cifre totali di cui 2 decimali.

# Riassunto Lezione: MySQL - SQL DDL e DML (Parte 2)

## 16. DDL - Valori di Default
- È possibile specificare un **valore di default** per un attributo.
- Usato quando non viene fornito un valore in fase di inserimento.
- Sintassi: `default <valore>` oppure `default null`.
- Esempio:  
  ```sql
  NumeroFigli SMALLINT DEFAULT 0
  ```

---

## 17. Esempio Creazione Tabella con FK
```sql
CREATE TABLE emp (
  emp_id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  dept_id CHAR(2) NOT NULL,
  emp_name VARCHAR(30) NOT NULL,
  deptno INT NOT NULL,
  sal FLOAT(4,2) NOT NULL,
  FOREIGN KEY (deptno) REFERENCES dept(dptno)
    ON UPDATE CASCADE
    ON DELETE NO ACTION
) ENGINE=InnoDB;

DROP TABLE emp;
```

---

## 18. Modifica Schema - `ALTER`
```sql
ALTER TABLE nome ADD nome_attributo tipo;
ALTER TABLE nome RENAME nuovo_nome;
CREATE TABLE IF NOT EXISTS nome (...);
```

Modifiche avanzate:
```sql
ALTER TABLE NomeTabella
  ALTER COLUMN NomeAttributo SET DEFAULT val;
  ADD CONSTRAINT NomeVincolo ...;
  DROP CONSTRAINT NomeVincolo;
  ADD COLUMN nuovo_attr tipo;
  DROP COLUMN nome_attr;
```

---

## 19. Comando `DROP`
Rimuove componenti:
```sql
DROP <schema | domain | table | view | assertion> nome_elemento [RESTRICT | CASCADE];
```

- `RESTRICT`: blocca se ci sono dipendenze.
- `CASCADE`: elimina anche le dipendenze.

---

## 20. Indici
Gli indici migliorano le prestazioni, ma sono componenti **fisici**, non logici.

```sql
CREATE INDEX indnome ON emp(ename);
DROP INDEX indnome ON emp;
```

---

## 21. DML - Manipolazione dei Dati
I principali comandi:
- `INSERT`
- `UPDATE`
- `DELETE`

---

## 22. `INSERT`
```sql
INSERT INTO NomeTabella [(ListaAttributi)] VALUES (...);
INSERT INTO NomeTabella SELECT ...;
```

Esempio:
```sql
INSERT INTO Dipartimento(NomeDip, Città)
VALUES ('Produzione', 'Torino');
```

Oppure:
```sql
INSERT INTO ProdottiMilanesi
SELECT codice, descrizione FROM Prodotto WHERE LuogoProd = 'Milano';
```

---

## 23. `UPDATE`
```sql
UPDATE nome_tabella
SET attr1 = val1, attr2 = val2
WHERE condizione;
```

Esempi:
```sql
UPDATE emp SET job = 'salesman', sal = 1.1 * sal WHERE ename = "Wilson";

UPDATE emp
SET sal = (SELECT 2 * AVG(sal) FROM emp WHERE job = 'salesman')
WHERE job = 'salesman';
```

Attenzione: SQL è orientato agli insiemi, non riga per riga.

---

## 24. `DELETE`
```sql
DELETE FROM nome_tabella WHERE condizione;
```

- Senza `WHERE` elimina tutte le righe.
- Con vincoli referenziali, attenzione alle **politiche CASCADE**.

---

## 25. Vincoli Intra-relazionali
- `NOT NULL`
- `UNIQUE (attr, attr)`
- `PRIMARY KEY (attr)` – unica, tutti gli attributi `NOT NULL`

Esempio:
```sql
Nome CHAR(20) NOT NULL,
Cognome CHAR(20) NOT NULL,
UNIQUE (Nome, Cognome)
```

---

## 26. Vincoli Referenziali (FK)
```sql
FOREIGN KEY (colonne) REFERENCES tabella(colonne)
ON DELETE CASCADE | SET NULL | SET DEFAULT | NO ACTION
ON UPDATE CASCADE | ...
```

Esempio:
```sql
CREATE TABLE Impiegato (
  Matricola CHAR(6) PRIMARY KEY,
  Nome CHAR(20) NOT NULL,
  Cognome CHAR(20) NOT NULL,
  Stipendio INT DEFAULT 0,
  UNIQUE (Cognome, Nome),
  FOREIGN KEY (Nome, Cognome)
    REFERENCES Anagrafica(Nome, Cognome)
) ENGINE=InnoDB;
```

---

## 27. Politiche Referenziali
- **UPDATE**
  - `CASCADE`: propaga la modifica
  - `SET NULL`: imposta a NULL
  - `SET DEFAULT`: imposta valore di default
  - `NO ACTION`: blocca l’operazione

- **DELETE**
  - stesso comportamento con rimozione

---

## 28. Vincoli Generici: `CHECK`
```sql
CHECK (condizione)
```

Esempio:
```sql
CHECK (sesso IN ('M','F'))

CHECK (Stipendio <= (SELECT Stipendio FROM Impiegato J WHERE Superiore = J.Matricola))
```

---

## 29. Asserzioni
Permettono vincoli **trasversali su più tabelle**.

```sql
CREATE ASSERTION AlmenoUnImpiegato
CHECK (1 <= (SELECT COUNT(*) FROM Impiegato));
```

---

## 30. Controllo dei Vincoli
- **IMMEDIATE**: controllo subito dopo l’operazione.
- **DEFERRED**: controllo alla fine della transazione.

Modifica:
```sql
SET CONSTRAINTS NomeVincolo IMMEDIATE;
SET CONSTRAINTS NomeVincolo DEFERRED;
```

---
