# SQL ‚Äì Interrogazioni: Riassunto Dettagliato

## üåê Introduzione alle Interrogazioni in SQL

In SQL, le interrogazioni (query) permettono di ottenere informazioni dai dati memorizzati nei database. La filosofia √® **dichiarativa**: non si dice *come* ottenere i dati, ma *quali* dati si vogliono.

> Esempio pratico: voglio sapere lo stipendio mensile di chi si chiama "Rossi". Dico solo cosa voglio ottenere, non come calcolarlo.

Il DBMS (Database Management System) riceve la query e la ottimizza, trasformandola nel suo linguaggio interno.

---

## üèóÔ∏è Struttura di base di una query SQL

La sintassi √® la seguente:

```sql
SELECT ListaAttributi
FROM ListaTabelle
[WHERE Condizione]
```

Pu√≤ includere:
- **Alias** per rinominare colonne o tabelle
- Operazioni aritmetiche nei risultati

### Esempio:
```sql
SELECT Stipendio/12 AS SalarioMensile
FROM Impiegato
WHERE Cognome = 'Rossi';
```
Questa query restituisce il salario mensile di chi si chiama Rossi.

üëâ Con `SELECT *` si selezionano **tutti** gli attributi della tabella.

---

## üìÑ Duplicati e `DISTINCT`

A differenza dell‚Äôalgebra relazionale, SQL **ammette duplicati**.

Per eliminarli:
```sql
SELECT DISTINCT Citt√†
FROM Persona;
```
Restituisce l‚Äôelenco delle citt√† **senza ripetizioni**.

---

## üîç Selezione e Proiezione

Concetti fondamentali nell'interrogazione dei dati:

- **Selezione (WHERE)**: filtra le righe.
- **Proiezione (SELECT)**: sceglie le colonne da mostrare.

### Esempi:
1. **Nome e Reddito delle persone < 30 anni**:
   ```sql
   SELECT Nome, Reddito
   FROM Persone
   WHERE Eta < 30;
   ```

2. **Tutti gli attributi di persone < 30 anni**:
   ```sql
   SELECT *
   FROM Persone
   WHERE Eta < 30;
   ```

3. **Solo Nome e Reddito di tutte le persone**:
   ```sql
   SELECT Nome, Reddito
   FROM Persone;
   ```

---

## üè∑Ô∏è Alias e abbreviazioni

Gli **alias** servono a rinominare colonne o tabelle temporaneamente:

```sql
SELECT Reddito/2 AS RedditoSemestrale
FROM Persone
WHERE Nome = 'Luigi';
```

Alias per tabelle:
```sql
SELECT p.nome, p.reddito
FROM persone p
WHERE p.eta < 30;
```

üëâ Questo rende le query pi√π leggibili, soprattutto quando si usano **join** o pi√π tabelle.

---

## üßÆ Espressioni nella SELECT

Nella lista degli attributi (`target list`) si possono inserire anche **espressioni**:

```sql
SELECT Reddito/2 AS RedditoSemestrale
FROM Persone
WHERE Nome = 'Luigi';
```

---

## üìå Clausola WHERE

Serve per **filtrare** i dati. Gli operatori supportati sono:

- Confronto: `=`, `<>`, `!=`, `<`, `>`, `<=`, `>=`
- Intervalli: `BETWEEN x AND y`
- Liste: `IN (...)`
- Pattern: `LIKE`
- Null: `IS NULL`, `IS NOT NULL`
- Logici: `NOT`, `AND`, `OR`

### Pattern con `LIKE`:
- `_` = un carattere qualsiasi
- `%` = qualsiasi numero di caratteri (anche zero)

```sql
SELECT *
FROM Impiegato
WHERE Cognome LIKE '_o%i'; -- es. Rossi, Rosi, Porti
```

---

## ‚ö†Ô∏è Gestione dei Valori NULL

I valori `NULL` indicano l‚Äô**assenza di un valore**. Non si pu√≤ usare `=` per confrontarli.

Esempio: trovare impiegati con et√† > 40 o senza et√†:
```sql
SELECT *
FROM Impiegati
WHERE Eta > 40 OR Eta IS NULL;
```

Tabella d‚Äôesempio:

|Matricola|Cognome|Filiale|Et√†|
|---|---|---|---|
|5555|Rossi|Roma|45|
|6666|Neri|Roma|NULL|

---

## üîó JOIN e prodotti cartesiani

Se nella clausola `FROM` compare **una sola tabella**, possiamo fare selezioni, proiezioni e alias.

Se invece compare **pi√π di una tabella**, SQL esegue un **join**, ovvero unisce i dati delle tabelle:

```sql
SELECT *
FROM Impiegato, Dipartimento
WHERE Impiegato.Dipart = Dipartimento.Nome;
```

Questo √® un **inner join** implicito (prodotto cartesiano + filtro).

---

## üìö Conclusione

La lezione copre:
- Come scrivere query base con `SELECT`
- Come filtrare dati con `WHERE`
- Come usare `DISTINCT`, `LIKE`, `IS NULL`, `IN`, `BETWEEN`
- Come calcolare espressioni nei risultati (`SalarioMensile`)
- Come unire pi√π tabelle con `JOIN`

# SQL ‚Äì Interrogazioni: Riassunto Dettagliato (Slide 25‚Äì50)

## üîÑ Selezione, Proiezione e JOIN

### Query con una sola tabella:
Permettono selezione, proiezione e ridenominazione.

### Query con pi√π tabelle:
Consentono di effettuare JOIN (unione logica) e prodotti cartesiani.

### Esempio:
```sql
SELECT Impiegato.Nome, Impiegato.Cognome, Dipartimento.Citt√†
FROM Impiegato, Dipartimento
WHERE Impiegato.Dipart = Dipartimento.Nome;
```

---

## üîó JOIN in SQL

JOIN = unire righe da pi√π tabelle quando c'√® una relazione logica tra loro.

### JOIN esplicito con `WHERE`
```sql
SELECT *
FROM Tabella1, Tabella2
WHERE Tabella1.colonna = Tabella2.colonna;
```

### JOIN con sintassi estesa
```sql
SELECT ...
FROM T1 [tipo_join] JOIN T2 ON condizione
```

**Tipo di JOIN:**
- `INNER JOIN` (default)
- `LEFT [OUTER] JOIN`
- `RIGHT [OUTER] JOIN`
- `FULL [OUTER] JOIN`

### Esempi reali:
- Padri di persone che guadagnano pi√π di 20
```sql
SELECT DISTINCT Padre
FROM Persone, Paternita
WHERE Figlio = Nome AND Reddito > 20;
```

- Persone che guadagnano pi√π dei padri:
```sql
SELECT f.Nome, f.Reddito, p.Reddito
FROM Persone p, Paternita, Persone f
WHERE p.Nome = Padre AND Figlio = f.Nome AND f.Reddito > p.Reddito;
```

---

## üß≠ Ordinamento con `ORDER BY`

### Sintassi:
```sql
SELECT Nome, Reddito
FROM Persone
WHERE Eta < 30
ORDER BY Nome ASC; -- o DESC
```

### Esempio:
Ordina i nomi delle persone < 30 anni in ordine alfabetico crescente.

---

## üîÅ Unione, Intersezione, Differenza

### UNION
Unisce i risultati di due SELECT.
```sql
SELECT * FROM A
UNION
SELECT * FROM B;
```

Per mantenere duplicati: `UNION ALL`

### EXCEPT
Restituisce righe di A che non sono in B:
```sql
SELECT * FROM A
EXCEPT
SELECT * FROM B;
```

### INTERSECT
Restituisce righe comuni tra A e B:
```sql
SELECT * FROM A
INTERSECT
SELECT * FROM B;
```

---

## üî¢ Operatori Aggregati

Usati per calcoli su insiemi di righe.

### Funzioni:
- `AVG()` media
- `COUNT()` conteggio
- `MAX()` massimo
- `MIN()` minimo
- `SUM()` somma

### Esempio:
```sql
SELECT COUNT(*) FROM Impiegato WHERE Nome = 'Rossi';
SELECT MAX(sal), MIN(sal), MAX(sal)-MIN(sal) FROM emp;
```

---

## üìä GROUP BY

Serve a **raggruppare** le righe in sottoinsiemi per calcolare aggregazioni per gruppo.

### Esempio:
```sql
SELECT Dipart, MAX(Stipendio)
FROM Impiegato
GROUP BY Dipart;
```

### Conteggio figli per padre:
```sql
SELECT Padre, COUNT(*) AS NumFigli
FROM Paternita
GROUP BY Padre;
```

---

## ‚úÖ GROUP BY e vincoli

√à obbligatorio includere nella `GROUP BY` tutti gli attributi che non sono funzioni aggregate nella `SELECT`.

### Esempio corretto:
```sql
SELECT Padre, AVG(f.Reddito), p.Reddito
FROM Persone f
JOIN Paternita ON Figlio = Nome
JOIN Persone p ON Padre = p.Nome
GROUP BY Padre, p.Reddito;
```

---

## ‚ö†Ô∏è GROUP BY con NULL

```sql
SELECT B, COUNT(*) FROM R GROUP BY B;
SELECT A, COUNT(*) FROM R GROUP BY A;
SELECT A, COUNT(B) FROM R GROUP BY A;
```

- `COUNT(*)` conta tutte le righe
- `COUNT(B)` esclude NULL in B

---

## üßæ HAVING: Condizioni sui Gruppi

### Quando usare `HAVING`?
Se la condizione si applica ai gruppi (non alle singole righe), va usata `HAVING` dopo `GROUP BY`.

### Esempio:
```sql
SELECT Dipart, SUM(Stipendio) AS SommaStipendi
FROM Impiegati
GROUP BY Dipart
HAVING SUM(Stipendio) > 100;
```

### Altro esempio:
Padri i cui figli hanno un reddito medio > 25
```sql
SELECT Padre, AVG(f.Reddito)
FROM Persone f JOIN Paternita ON Figlio = Nome
GROUP BY Padre
HAVING AVG(f.Reddito) > 25;
```

